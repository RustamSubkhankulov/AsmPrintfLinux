     1                                  %ifndef rsPrintUnitTests
     2                                  %define rsPrintUnitTests
     3                                  
     4                                  ;================================================
     5                                  
     6                                  global  UnitTesting
     7                                  
     8                                  extern  RsPrint
     9                                  
    10                                  ;================================================
    11                                  
    12                                  section .text 
    13                                  
    14                                  ;===================MACRO========================
    15                                  
    16                                  ;-------------------.PAUSE-----------------------
    17                                  
    18                                  %macro      .PAUSE 0 
    19                                                                          ; getchar();
    20                                  	        nop
    21                                  		    xor rax, rax                ; read
    22                                  
    23                                  		    mov rdi, 0                  ; stdin - first arg
    24                                              mov rsi, PauseBuf
    25                                                                          ; char* buf - second arg
    26                                              mov rdx, 1                  ; read one byte
    27                                  
    28                                              syscall                     ; call read         
    29                                              
    30                                  		    nop
    31                                  %endmacro
    32                                  
    33                                  [section .data] 
    34                                  
    35 00000000 00                      PauseBuf    db 0                        ; reads one symb
    36                                  
    37                                  __SECT__
    38                                  
    39                                  ;=================FUNCTIONS======================
    40                                  
    41                                  ;----------------UnitTesting---------------------
    42                                  ;
    43                                  ; Descr: executes unit testing of RsPrint
    44                                  ;
    45                                  ;------------------------------------------------
    46                                  
    47                                  UnitTesting:
    48                                  
    49 00000000 E81C010000                      call CharUnitTest
    50                                          .PAUSE
    50                              <1> 
    50 00000005 90                  <1>  nop
    50 00000006 4831C0              <1>  xor rax, rax
    50                              <1> 
    50 00000009 BF00000000          <1>  mov rdi, 0
    50 0000000E 48BE-               <1>  mov rsi, PauseBuf
    50 00000010 [0000000000000000]  <1>
    50                              <1> 
    50 00000018 BA01000000          <1>  mov rdx, 1
    50                              <1> 
    50 0000001D 0F05                <1>  syscall
    50                              <1> 
    50 0000001F 90                  <1>  nop
    51                                  
    52 00000020 E80D010000                      call StrUnitTest
    53                                          .PAUSE
    53                              <1> 
    53 00000025 90                  <1>  nop
    53 00000026 4831C0              <1>  xor rax, rax
    53                              <1> 
    53 00000029 BF00000000          <1>  mov rdi, 0
    53 0000002E 48BE-               <1>  mov rsi, PauseBuf
    53 00000030 [0000000000000000]  <1>
    53                              <1> 
    53 00000038 BA01000000          <1>  mov rdx, 1
    53                              <1> 
    53 0000003D 0F05                <1>  syscall
    53                              <1> 
    53 0000003F 90                  <1>  nop
    54                                  
    55 00000040 E801010000                      call DecUnitTest
    56                                          .PAUSE
    56                              <1> 
    56 00000045 90                  <1>  nop
    56 00000046 4831C0              <1>  xor rax, rax
    56                              <1> 
    56 00000049 BF00000000          <1>  mov rdi, 0
    56 0000004E 48BE-               <1>  mov rsi, PauseBuf
    56 00000050 [0000000000000000]  <1>
    56                              <1> 
    56 00000058 BA01000000          <1>  mov rdx, 1
    56                              <1> 
    56 0000005D 0F05                <1>  syscall
    56                              <1> 
    56 0000005F 90                  <1>  nop
    57                                  
    58 00000060 E8F5000000                      call OctUnitTest
    59                                          .PAUSE
    59                              <1> 
    59 00000065 90                  <1>  nop
    59 00000066 4831C0              <1>  xor rax, rax
    59                              <1> 
    59 00000069 BF00000000          <1>  mov rdi, 0
    59 0000006E 48BE-               <1>  mov rsi, PauseBuf
    59 00000070 [0000000000000000]  <1>
    59                              <1> 
    59 00000078 BA01000000          <1>  mov rdx, 1
    59                              <1> 
    59 0000007D 0F05                <1>  syscall
    59                              <1> 
    59 0000007F 90                  <1>  nop
    60                                  
    61 00000080 E8E6000000                      call HexUnitTest
    62                                          .PAUSE
    62                              <1> 
    62 00000085 90                  <1>  nop
    62 00000086 4831C0              <1>  xor rax, rax
    62                              <1> 
    62 00000089 BF00000000          <1>  mov rdi, 0
    62 0000008E 48BE-               <1>  mov rsi, PauseBuf
    62 00000090 [0000000000000000]  <1>
    62                              <1> 
    62 00000098 BA01000000          <1>  mov rdx, 1
    62                              <1> 
    62 0000009D 0F05                <1>  syscall
    62                              <1> 
    62 0000009F 90                  <1>  nop
    63                                  
    64 000000A0 E8DA000000                      call BinUnitTest
    65                                          .PAUSE
    65                              <1> 
    65 000000A5 90                  <1>  nop
    65 000000A6 4831C0              <1>  xor rax, rax
    65                              <1> 
    65 000000A9 BF00000000          <1>  mov rdi, 0
    65 000000AE 48BE-               <1>  mov rsi, PauseBuf
    65 000000B0 [0000000000000000]  <1>
    65                              <1> 
    65 000000B8 BA01000000          <1>  mov rdx, 1
    65                              <1> 
    65 000000BD 0F05                <1>  syscall
    65                              <1> 
    65 000000BF 90                  <1>  nop
    66                                  
    67 000000C0 E8CB000000                      call PercUnitTest
    68                                          .PAUSE
    68                              <1> 
    68 000000C5 90                  <1>  nop
    68 000000C6 4831C0              <1>  xor rax, rax
    68                              <1> 
    68 000000C9 BF00000000          <1>  mov rdi, 0
    68 000000CE 48BE-               <1>  mov rsi, PauseBuf
    68 000000D0 [0000000000000000]  <1>
    68                              <1> 
    68 000000D8 BA01000000          <1>  mov rdx, 1
    68                              <1> 
    68 000000DD 0F05                <1>  syscall
    68                              <1> 
    68 000000DF 90                  <1>  nop
    69                                  
    70 000000E0 E8BA000000                      call DefUnitTest
    71                                          .PAUSE
    71                              <1> 
    71 000000E5 90                  <1>  nop
    71 000000E6 4831C0              <1>  xor rax, rax
    71                              <1> 
    71 000000E9 BF00000000          <1>  mov rdi, 0
    71 000000EE 48BE-               <1>  mov rsi, PauseBuf
    71 000000F0 [0000000000000000]  <1>
    71                              <1> 
    71 000000F8 BA01000000          <1>  mov rdx, 1
    71                              <1> 
    71 000000FD 0F05                <1>  syscall
    71                              <1> 
    71 000000FF 90                  <1>  nop
    72                                  
    73 00000100 E8A9000000                      call ComplexUnitTest
    74                                          .PAUSE
    74                              <1> 
    74 00000105 90                  <1>  nop
    74 00000106 4831C0              <1>  xor rax, rax
    74                              <1> 
    74 00000109 BF00000000          <1>  mov rdi, 0
    74 0000010E 48BE-               <1>  mov rsi, PauseBuf
    74 00000110 [0000000000000000]  <1>
    74                              <1> 
    74 00000118 BA01000000          <1>  mov rdx, 1
    74                              <1> 
    74 0000011D 0F05                <1>  syscall
    74                              <1> 
    74 0000011F 90                  <1>  nop
    75                                  
    76 00000120 C3                              ret 
    77                                  
    78                                  ;----------------CharUnitTest--------------------
    79                                  ;
    80                                  ; Descr: tests '%c' specifier
    81                                  ;
    82                                  ; Entry: none
    83                                  ;
    84                                  ; Exit : none
    85                                  ;
    86                                  ; Destr: 
    87                                  ;------------------------------------------------
    88                                  
    89                                  CharUnitTest:
    90                                  
    91 00000121 6A21                            push '!'
    92 00000123 68[3B000000]                    push CharFormatStr              ; push arguments
    93                                  
    94 00000128 E8(00000000)                    call RsPrint
    95                                  
    96 0000012D 4883C410                        add rsp, 16                     
    97                                  
    98 00000131 C3                              ret 
    99                                  
   100                                  ;-----------------StrUnitTest--------------------
   101                                  ;
   102                                  ; Descr: tests '%s' specifier
   103                                  ;
   104                                  ; Entry: none
   105                                  ;
   106                                  ; Exit : none
   107                                  ;
   108                                  ; Destr:
   109                                  ;------------------------------------------------
   110                                  
   111                                  StrUnitTest:
   112                                  
   113 00000132 68[01000000]                    push StrArgument
   114 00000137 68[61000000]                    push StrFormatStr
   115                                  
   116 0000013C E8(00000000)                    call RsPrint
   117                                  
   118 00000141 4883C410                        add rsp, 16
   119                                  
   120 00000145 C3                              ret 
   121                                  
   122                                  [section .data] 
   123 00000001 52757374616D00          StrArgument db "Rustam", 0
   124                                  __SECT__ 
   125                                  
   126                                  ;-----------------DecUnitTest--------------------
   127                                  ;
   128                                  ; Descr: tests '%d' specifier
   129                                  ;
   130                                  ; Entry: none
   131                                  ;
   132                                  ; Exit : none
   133                                  ;
   134                                  ; Destr:
   135                                  ;------------------------------------------------
   136                                  
   137                                  DecUnitTest:
   138                                  
   139 00000146 68E8040000                      push 1256d
   140 0000014B 68[A6000000]                    push DecFormatStr
   141                                  
   142 00000150 E8(00000000)                    call RsPrint
   143                                  
   144 00000155 4883C410                        add rsp, 16 
   145                                  
   146 00000159 C3                              ret 
   147                                  
   148                                  ;-----------------OctUnitTest--------------------
   149                                  ;
   150                                  ; Descr: tests '%o' specifier
   151                                  ;
   152                                  ; Entry: none
   153                                  ;
   154                                  ; Exit : none
   155                                  ;
   156                                  ; Destr:
   157                                  ;------------------------------------------------
   158                                  
   159                                  OctUnitTest:
   160                                  
   161 0000015A 6A18                            push 24d
   162 0000015C 68[C5000000]                    push OctFormatStr
   163                                  
   164 00000161 E8(00000000)                    call RsPrint
   165                                  
   166 00000166 4883C410                        add rsp, 16
   167                                          
   168 0000016A C3                              ret
   169                                  ;-----------------HexUnitTest--------------------
   170                                  ;
   171                                  ; Descr: tests '%x' specifier
   172                                  ;
   173                                  ; Entry: none
   174                                  ;
   175                                  ; Exit : none
   176                                  ;
   177                                  ; Destr:
   178                                  ;------------------------------------------------
   179                                  
   180                                  HexUnitTest:
   181                                  
   182 0000016B 68DA0E0000                      push 3802d
   183 00000170 68[E2000000]                    push HexFormatStr
   184                                          
   185 00000175 E8(00000000)                    call RsPrint
   186                                  
   187 0000017A 4883C410                        add rsp, 16
   188                                  
   189 0000017E C3                              ret 
   190                                  ;-----------------BinUnitTest--------------------
   191                                  ;
   192                                  ; Descr: tests '%b' specifier
   193                                  ;
   194                                  ; Entry: none
   195                                  ;
   196                                  ; Exit : none
   197                                  ;
   198                                  ; Destr:
   199                                  ;------------------------------------------------
   200                                  
   201                                  BinUnitTest:
   202                                  
   203 0000017F 6A5B                            push 1011011b
   204 00000181 68[84000000]                    push BinFormatStr
   205                                  
   206 00000186 E8(00000000)                    call RsPrint
   207                                  
   208 0000018B 4883C410                        add rsp, 16
   209                                  
   210 0000018F C3                              ret 
   211                                  
   212                                  ;-----------------PercUnitTest-------------------
   213                                  ;
   214                                  ; Descr: tests '%%' specifier
   215                                  ;
   216                                  ; Entry: none
   217                                  ;
   218                                  ; Exit : none 
   219                                  ;
   220                                  ; Destr:
   221                                  ;------------------------------------------------
   222                                  
   223                                  PercUnitTest:
   224                                  
   225 00000190 68[08000000]                    push PercFormatStr
   226                                  
   227 00000195 E8(00000000)                    call RsPrint
   228                                  
   229 0000019A 4883C408                        add rsp, 8
   230                                  
   231 0000019E C3                              ret 
   232                                  
   233                                  ;-----------------DefUnitTest--------------------
   234                                  ;
   235                                  ; Descr: tests default case ( %f, %1 and etc)
   236                                  ;
   237                                  ; Entry: none
   238                                  ;
   239                                  ; Exit : none 
   240                                  ;
   241                                  ; Destr:
   242                                  ;------------------------------------------------
   243                                  
   244                                  DefUnitTest:
   245                                  
   246 0000019F 68[1B000000]                    push DefFormatStr
   247                                  
   248 000001A4 E8(00000000)                    call RsPrint
   249                                  
   250 000001A9 6683C408                        add sp, 8
   251                                  
   252 000001AD C3                              ret 
   253                                  
   254                                  ;-----------------ComplexUnitTest----------------
   255                                  ;
   256                                  ; Descr: tests different specifiers in one format
   257                                  ;        string
   258                                  ;
   259                                  ; Entry: none
   260                                  ;
   261                                  ; Exit : none 
   262                                  ;
   263                                  ; Destr:
   264                                  ;------------------------------------------------
   265                                  
   266                                  ComplexUnitTest:
   267                                  
   268 000001AE 68AB250000                      push 25ABh
   269 000001B3 6A18                            push 24d 
   270 000001B5 68B3000000                      push 10110011b
   271 000001BA 68FFE80300                      push 256255d
   272 000001BF 6A21                            push '!'
   273 000001C1 68[01000000]                    push StrArgument
   274 000001C6 68[FB000000]                    push ComplexFormatStr
   275                                  
   276 000001CB E8(00000000)                    call RsPrint
   277                                  
   278 000001D0 4883C438                        add rsp, 56
   279                                  
   280 000001D4 C3                              ret 
   281                                  
   282                                  ;================================================
   283                                  
   284                                  [section .data] 
   285                                  
   286                                  ;------------------------------------------------
   287                                  
   288 00000008 54657374696E672025-     PercFormatStr:  db "Testing %%%% : %%", 0Ah, 0
   288 00000011 252525203A2025250A-
   288 0000001A 00                 
   289                                  
   290                                  ;------------------------------------------------
   291                                  
   292 0000001B 54657374696E672064-     DefFormatStr:   db "Testing default case: %a %1 %$", 0Ah, 0
   292 00000024 656661756C74206361-
   292 0000002D 73653A202561202531-
   292 00000036 2025240A00         
   293                                  
   294                                  ;------------------------------------------------
   295                                  
   296 0000003B 54657374696E672025-     CharFormatStr:  db "Testing %%c: printing symbol ! -  %c", 0Ah, 0
   296 00000044 25633A207072696E74-
   296 0000004D 696E672073796D626F-
   296 00000056 6C2021202D20202563-
   296 0000005F 0A00               
   297                                  
   298                                  ;------------------------------------------------
   299                                  
   300 00000061 54657374696E672025-     StrFormatStr:   db "Testing %%s: string 'Rustam' - %s", 0Ah, 0
   300 0000006A 25733A20737472696E-
   300 00000073 67202752757374616D-
   300 0000007C 27202D2025730A00   
   301                                  
   302                                  ;------------------------------------------------
   303                                  
   304 00000084 54657374696E672025-     BinFormatStr:   db "Testing %%b: number 1011011 - %b", 0Ah, 0
   304 0000008D 25623A206E756D6265-
   304 00000096 722031303131303131-
   304 0000009F 202D2025620A00     
   305                                  
   306                                  ;------------------------------------------------
   307                                  
   308 000000A6 54657374696E672025-     DecFormatStr:   db "Testing %%d: number 1256 - %d", 0Ah, 0
   308 000000AF 25643A206E756D6265-
   308 000000B8 722031323536202D20-
   308 000000C1 25640A00           
   309                                  
   310                                  ;------------------------------------------------
   311                                  
   312 000000C5 54657374696E672025-     OctFormatStr:   db "Testing %%o: number 30 - %o", 0Ah, 0
   312 000000CE 256F3A206E756D6265-
   312 000000D7 72203330202D20256F-
   312 000000E0 0A00               
   313                                  
   314                                  ;------------------------------------------------
   315                                  
   316 000000E2 54657374696E672025-     HexFormatStr:   db "Testing %%x: 3802d - %x", 0Ah, 0
   316 000000EB 25783A203338303264-
   316 000000F4 202D2025780A00     
   317                                  
   318                                  ;------------------------------------------------
   319                                  
   320                                  ComplexFormatStr:
   321 000000FB 537472696E673A2052-                     db "String: Rustam - %s, char ! - %c, decimal 256255 - %d, binary 10110011 - %b, oct 30 - %o, hex 25AB - %x", 0Ah, 0
   321 00000104 757374616D202D2025-
   321 0000010D 732C20636861722021-
   321 00000116 202D2025632C206465-
   321 0000011F 63696D616C20323536-
   321 00000128 323535202D2025642C-
   321 00000131 2062696E6172792031-
   321 0000013A 30313130303131202D-
   321 00000143 2025622C206F637420-
   321 0000014C 3330202D20256F2C20-
   321 00000155 686578203235414220-
   321 0000015E 2D2025780A00       
   322                                  
   323                                  __SECT__
   324                                  
   325                                  ;================================================
   326                                  
   327                                  %endif 
   328                                  
   329                                  
   330                                  
   331                                  
   332                                  
   333                                  
   334                                  
   335                                  
   336                                  
   337                                  
